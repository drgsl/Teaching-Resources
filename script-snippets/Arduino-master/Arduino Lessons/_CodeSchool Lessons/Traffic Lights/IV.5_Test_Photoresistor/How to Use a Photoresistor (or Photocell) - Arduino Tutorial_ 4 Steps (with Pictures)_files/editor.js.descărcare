function jsObjClone(obj){var objcopy={};for(var i in obj){if(obj.hasOwnProperty(i)){objcopy[i]=obj[i]}}return objcopy}function checkObjEquals(a,b){var aProps=Object.getOwnPropertyNames(a);var bProps=Object.getOwnPropertyNames(b);if(aProps.length!=bProps.length){return false}for(var i=0;i<aProps.length;i++){var propName=aProps[i];if(a[propName]!==b[propName]){return false}}return true}function objDiff(a,b){var diff={};var k;for(k in a){if(!b.hasOwnProperty(k)){diff[k]=a[k]}}for(k in b){if(!a.hasOwnProperty(k)){diff[k]=b[k]}}return diff}function isInoFile(filename){var ino_re=/^.+\.ino$/;var status=false;if(ino_re.test(filename)){status=true}return status}eventManager=new function(){this._listeners={};this.addListener=function(type,listener){if(typeof this._listeners[type]=="undefined"){this._listeners[type]=[]}this._listeners[type].push(listener)};this.fire=function(event,param1,param2,param3){if(typeof event=="string"){event={type:event}}if(!event.target){event.target=this}if(!event.type){throw new Error("Event object missing 'type' property.")}if(this._listeners[event.type]instanceof Array){var listeners=this._listeners[event.type];for(var i=0,len=listeners.length;i<len;i++){if(typeof param1!=="undefined"){if(typeof param2!=="undefined"){if(typeof param3!=="undefined"){listeners[i].call(this,param1,param2,param3)}else{listeners[i].call(this,param1,param2)}}else{listeners[i].call(this,param1)}}else{listeners[i].call(this)}}}};this.removeListener=function(type,listener){if(this._listeners[type]instanceof Array){var listeners=this._listeners[type];for(var i=0,len=listeners.length;i<len;i++){if(listeners[i]===listener){listeners.splice(i,1);break}}}}};function decodeHtml(htmlString){var map={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#039;":"'"};return htmlString.replace(/&amp;|&lt;|&gt;|&quot;|&#039;/g,function(m){return map[m]})}
editor=function(editor,files,projectView){var self=this;function noBoardSelectedHandler(position){if(!compilerflasher.selectedBoard){if(!self.position||position.row!=self.position.row){self.position=position}if(self.position.row==position.row&&self.position.column==position.column){compilerflasher.setOperationOutput('<i class="icon-remove"></i> Please select a board first.')}self.position=position;return false}return true}this.cbenderCompleter={getCompletions:function(editor,session,pos,prefix,callback){var check=noBoardSelectedHandler(pos);if(check&&!window.autoCompleteTimeout){window.autoCompleteTimeout=setTimeout(function(){window.autoCompleteTimeout=null;payload=$.parseJSON(compilerflasher.generate_payload("autocomplete"));payload.position.row+=1;payload.position.column+=1;payload.prefix=prefix;$.post(window.codebender.editor.autocomplete,JSON.stringify(payload),function(data){autocc=JSON.parse(data);if(autocc.success===false){setOperationOutput(autocc.message);return}results=JSON.parse(autocc.autocomplete);wordlist=[];for(i=0;i<results.length;i++){wordlist.push({name:"",value:results[i].v,caption:results[i].c,meta:results[i].m,score:results[i].p})}callback(null,wordlist)})},1500)}}};ace.require("ace/ext/language_tools");this.lineRange=ace.require("ace/range").Range;this.aceEditor=ace.edit(editor);var aceEditor=this.aceEditor;this.mode="ace/mode/arduino";aceEditor.setTheme("ace/theme/textmate");aceEditor.setOptions({enableBasicAutocompletion:true});editorSyntaxHighlighter.setEditor(aceEditor);editorSyntaxHighlighter.loadCleanMode();editorLibrarySearch=new editorLibrarySearch(aceEditor,projectView);editorHeaderDetection=new editorHeaderDetection(files);editorDummyHeaderDetection=new editorDummyHeaderDetection;aceEditor.completers=[this.cbenderCompleter];window.contextSwitch=false;this.openFile=function(session){this.aceEditor.setSession(session);this.changeCurrentSession(session)};function changeCursorCallback(){if(window.contextSwitch){return}if(fileManager.state[fileManager.openFname]){fileManager.state[fileManager.openFname].cursor=aceEditor.getCursorPosition()}}var $lineCount=$("#line_count");this.changeCurrentSession=function(session){function changeCallback(){editorSyntaxHighlighter.update();$lineCount.html(session.getLength())}session.setUseSoftTabs(false);editorSyntaxHighlighter.setSession(session);editorSyntaxHighlighter.update();$lineCount.html(session.getLength());session.removeEventListener("change",changeCallback);session.on("change",changeCallback);session.setMode({path:this.mode,v:Date.now()});editorLibrarySearch.setSession();editorHeaderDetection.setSession();editorDummyHeaderDetection.setSession();session.selection.removeEventListener("changeCursor",changeCursorCallback);session.selection.on("changeCursor",changeCursorCallback)};this.addCommands=function(){aceEditor.commands.addCommand({name:"saveFile",bindKey:{win:"Ctrl-S",mac:"Command-S",sender:"editor|cli"},exec:function(){if(window.inRealEditor){save()}}});aceEditor.commands.addCommand({name:"programmerUpload",bindKey:{win:"Ctrl-Shift-U",mac:"Command-Shift-U",sender:"editor|cli"},exec:function(){compilerflasher.usbflashWithProgrammer()}});aceEditor.commands.addCommand({name:"verifyFile",bindKey:{win:"Ctrl-R",mac:"Command-R",sender:"editor|cli"},exec:function(){compilerflasher.verify()}});aceEditor.commands.addCommand({name:"uploadFile",bindKey:{win:"Ctrl-U",mac:"Command-U",sender:"editor|cli"},exec:function(){compilerflasher.usbflash()}});aceEditor.commands.addCommand({name:"MyComments",bindKey:{win:"Ctrl-/",mac:"Command-/",sender:"editor|cli"},exec:function(){aceEditor.toggleCommentLines()}});aceEditor.commands.addCommand({name:"serialMonitor",bindKey:{win:"Ctrl-Shift-M",mac:"Command-Shift-M",sender:"editor|cli"},exec:function(){open_serial_monitor_keybinding();compilerflasher.pluginHandler.toggle()}});aceEditor.commands.addCommand({name:"autoFormat",bindKey:{win:"Ctrl-Alt-[",mac:"Command-Alt-[",sender:"editor|cli"},exec:function(){autoFormat()}})};this.setReadOnly=function(readOnly){var $aceContent=$(".ace_content");if(readOnly){aceEditor.setShowPrintMargin(false);aceEditor.setOptions({readOnly:true,highlightActiveLine:false,highlightGutterLine:false});aceEditor.renderer.$cursorLayer.element.style.opacity=0;$(".ace_active-line, .ace_gutter-active-line").css("opacity",0);aceEditor.on("focus",function(){aceEditor.renderer.$cursorLayer.element.style.opacity=0;$(".ace_active-line, .ace_gutter-active-line").css("opacity",0)});aceEditor.on("blur",function(){aceEditor.renderer.$cursorLayer.element.style.opacity=0;$(".ace_active-line, .ace_gutter-active-line").css("opacity",0)});$aceContent.removeClass("read-write");window.editorReadOnly=true}else{aceEditor.setShowPrintMargin(true);aceEditor.setOptions({readOnly:false,highlightActiveLine:true,highlightGutterLine:true});aceEditor.renderer.$cursorLayer.element.style.opacity=1;$(".ace_active-line, .ace_gutter-active-line").css("opacity",1);aceEditor.on("focus",function(){aceEditor.renderer.$cursorLayer.element.style.opacity=1;$(".ace_active-line, .ace_gutter-active-line").css("opacity",1)});aceEditor.on("blur",function(){aceEditor.renderer.$cursorLayer.element.style.opacity=0;$(".ace_active-line, .ace_gutter-active-line").css("opacity",0)});$aceContent.addClass("read-write");aceEditor.focus();window.editorReadOnly=false}};aceEditor.$blockScrolling=Infinity};
fileManager=function(filelist){this.state={};this.savedState={};this.inoFname=null;this.openFname=null;this.currentState=null;var self=this;this.getContent=function(filename){if(!this.state.hasOwnProperty(filename)){return}return this.state[filename].session.getValue()};this.setContent=function(filename,content){if(!this.state.hasOwnProperty(filename)){return}this.state[filename].session.setValue(decodeHtml(content))};this.openFile=function(filename){if(!this.state.hasOwnProperty(filename)){return}if(filename==this.openFname){return}if(this.openFname&&this.state[this.openFname]){this.state[this.openFname].cursor=editor.aceEditor.getCursorPosition()}editor.openFile(this.state[filename].session);this.openFname=filename;this.removeMarkers(filename);this.showAnotations(filename);eventManager.fire("file-opened")};this.addFile=function(filename,content){var session;session=ace.createEditSession(content,editor.mode);if(!this.state.hasOwnProperty(filename)){this.state[filename]={}}this.state[filename].session=session;this.savedState[filename]=this.getContent(filename)};this.removeFile=function(filename){if(this.state.hasOwnProperty(filename)){this.state[filename].session.destroy();delete this.state[filename]}if(this.savedState.hasOwnProperty(filename)){delete this.savedState[filename]}};this.renameFile=function(oldFname,newFname){if(this.state.hasOwnProperty(oldFname)){this.state[newFname]=this.state[oldFname];delete this.state[oldFname]}if(this.savedState.hasOwnProperty(oldFname)){self.savedState[newFname]=self.savedState[oldFname];delete self.savedState[oldFname]}if(isInoFile(newFname)){self.inoFname=newFname}};this.getFiles=function(){var files={};Object.keys(this.state).forEach(function(filename){if(!self.state.hasOwnProperty(filename)){return}files[filename]=decodeHtml(self.getContent(filename))});return files};this.setFiles=function(docState){var localState=this.getFiles();Object.keys(docState).forEach(function(filename){if(localState.hasOwnProperty(filename)){self.setContent(filename,docState[filename])}});if(Object.keys(localState).length<Object.keys(docState).length){Object.keys(docState).forEach(function(filename){if(!localState.hasOwnProperty(filename)){self.addFile(filename,docState[filename])}})}else if(Object.keys(localState).length>Object.keys(docState).length){Object.keys(localState).forEach(function(filename){if(!docState.hasOwnProperty(filename)){self.removeFile(filename)}})}else{var oldFname=null;Object.keys(localState).forEach(function(filename){if(!docState.hasOwnProperty(filename)){oldFname=filename}});var newFname=null;Object.keys(docState).forEach(function(filename){if(!localState.hasOwnProperty(filename)){newFname=filename}});if(oldFname&&newFname){this.renameFile(oldFname,newFname)}}};this.updateSavedState=function(action){var state=this.getFiles();var diff,filename;Object.keys(state).forEach(function(){if(!self.savedState.hasOwnProperty(filename)){if(action=="addFile"){self.savedState[filename]=state[filename]}else if(action=="renameFile"){diff=filename}}});Object.keys(self.savedState).forEach(function(){if(!state.hasOwnProperty(filename)){if(action=="removeFile"){delete self.savedState[filename]}else if(action=="renameFile"&&diff!==null){self.savedState[diff]=self.savedState[filename];delete self.savedState[filename]}}})};this.getCurrentState=function(){var state=this.getFiles();if(state.hasOwnProperty(this.openFname)){state[this.openFname]=editor.aceEditor.getValue()}return state};this.saveState=function(){this.savedState=this.getFiles()};this.isStateSaved=function(){return checkObjEquals(this.getFiles(),this.savedState)};this.isFile=function(filename){return this.state.hasOwnProperty(filename)};this.addAnnotation=function(filename,row,column,text){if(!fileManager.state.hasOwnProperty(filename)){return}if(!fileManager.annotations){fileManager.annotations={}}if(!fileManager.annotations.hasOwnProperty(filename)){fileManager.annotations[filename]=[]}fileManager.annotations[filename].push({row:row-1,column:column,text:text,type:"error"})};this.showAnotations=function(filename){if(!fileManager.state.hasOwnProperty(filename)){return}if(!fileManager.annotations){return}if(fileManager.annotations.hasOwnProperty(filename)){fileManager.state[filename].session.setAnnotations(fileManager.annotations[filename])}};this.clearAnnotations=function(){Object.keys(this.state).forEach(function(filename){self.state[filename].session.clearAnnotations()});this.annotations={}};this.removeMarkers=function(filename){var markers=self.state[filename].session.getMarkers();Object.keys(markers).forEach(function(key){var marker=markers[key];if(marker.clazz=="compilerErrorMarker"){self.state[filename].session.removeMarker(marker.id)}})};this.removeAllMarkers=function(){Object.keys(this.state).forEach(function(filename){var markers=self.state[filename].session.getMarkers();Object.keys(markers).forEach(function(key){var marker=markers[key];if(marker.clazz=="compilerErrorMarker"){self.state[filename].session.removeMarker(marker.id)}})})};this.initialize=function(filelist){this.state={};this.savedState={};this.inoFname=null;this.openFname=null;this.currentState=null;var files=Object.keys(filelist).sort(function(a,b){if(isInoFile(a)||isInoFile(b)){return-1}if(a>b){return-1}else if(a<b){return 1}return 0});var saveStateFlag=true;files.forEach(function(filename){if(!self.state.hasOwnProperty(filename)){self.addFile(filename,decodeHtml(filelist[filename]))}else{self.setContent(filename,filelist[filename]);saveStateFlag=false}if(isInoFile(filename)){self.inoFname=filename}});this.currentState=this.getFiles();if(saveStateFlag){this.saveState()}};if(Object.keys(filelist).length){this.initialize(filelist)}};
var editorSyntaxHighlighter=function(){var ed=null;var loadedLibs=[];var cachedLibData={};var libraryFiles={};var personalLibraryFiles={};var personalLibraries=[];var updateTimeout=null;function my(){}my.getPersonalLibraries=function(){$.ajax({url:window.codebender.editor.personalLibraryFiles,type:"POST",dataType:"json"}).done(function(data){if($.isEmptyObject(data)){return}var files,i;for(var library in data){if(data.hasOwnProperty(library)&&data[library].hasOwnProperty("files")){files=data[library].files;for(i=0;i<files.length;i++){if(!personalLibraryFiles.hasOwnProperty(files[i].filename)){personalLibraryFiles[files[i].filename]=[]}personalLibraryFiles[files[i].filename].push({library:library,location:"personal"});if(personalLibraries.indexOf(library)==-1){personalLibraries.push(library)}}}}})};my.getPersonalLibraries();my.setEditor=function(a){ed=a};my.setSession=function(session){my.session=session};my.loadCleanMode=function(){window.codebenderModeLibrary=[];window.codebenderModeLibrary["keywords"]="";window.codebenderModeLibrary["builtinFunctions"]="";window.codebenderModeLibrary["builtinConstants"]=""};my.initLoadedLibs=function(){var oldLoadedLibs=loadedLibs;loadedLibs=[];var comments_re=/(?:\/\*(?:[\s\S]*?)\*\/)|(?:([\s;])+\/\/(?:.*)$)/gm;var text_body=editor.aceEditor.getSession().getValue();text_body=text_body.replace(comments_re,"");var allLines=text_body.split("\n");var totalLines=allLines.length;var re1=/^\s*#\s*include\s*<([a-zA-Z0-9._\/\+\(\)]+)\.h>\s*/;var re2=/^\s*#\s*include\s*"([a-zA-Z0-9._\/\+\(\)]+)\.h"\s*/;for(var lineNumber=0;lineNumber<totalLines;lineNumber++){var currentLine=allLines[lineNumber];var res1=re1.exec(currentLine);var res2=re2.exec(currentLine);if(res1&&loadedLibs.indexOf(res1[1])==-1){loadedLibs.push(res1[1]);continue}if(res2&&loadedLibs.indexOf(res2[1])==-1){loadedLibs.push(res2[1])}}var flagSkipProcess=true;if(loadedLibs.length!=oldLoadedLibs.length){flagSkipProcess=false}for(var i=0;i<loadedLibs.length;i++){if(oldLoadedLibs.indexOf(loadedLibs[i])==-1){flagSkipProcess=false;break}}if(!flagSkipProcess||typeof window.codebenderModeLibrary==="undefined"){my.updateCachedLibData()}};my.update=function(){if(updateTimeout!==null){clearTimeout(updateTimeout)}updateTimeout=setTimeout(my.initLoadedLibs.bind(this),500)};my.updateCachedLibData=function(){var missingLibs=[];for(var i=0;i<loadedLibs.length;i++){if(!cachedLibData.hasOwnProperty(loadedLibs[i])){missingLibs.push(loadedLibs[i])}}if(missingLibs.length>0){$.ajax({url:window.codebender.editor.libraryKeywords,data:JSON.stringify({libraryNames:missingLibs}),type:"POST",dataType:"json"}).done(function(data){if(data["success"]){for(var key in data["individualLibraries"]){if(data["individualLibraries"].hasOwnProperty(key)){if(!cachedLibData.hasOwnProperty(key)){cachedLibData[key]=data["individualLibraries"][key]}}}}my.triggerEditor()});function checkIfExists(hay,niddle){var found=false;hay.forEach(function(current){if(current.library==niddle.library&&current.location==niddle.location){found=true}});return found}$.ajax({url:window.codebender.editor.systemLibrariesFileList,data:JSON.stringify({libraryNames:missingLibs}),type:"POST",dataType:"json"}).done(function(data){if(data["success"]){if(!data.hasOwnProperty("libraryFiles")){return}var i,filename;for(var library in data["libraryFiles"]){if(data["libraryFiles"].hasOwnProperty(library)){for(i=0;i<data["libraryFiles"][library].length;i++){filename=data["libraryFiles"][library][i]["file_name"];if(!libraryFiles.hasOwnProperty(filename)){libraryFiles[filename]=[]}var newLibrary={library:library,location:data["libraryFiles"][library][i]["location"]};var found=checkIfExists(libraryFiles[filename],newLibrary);if(!found){libraryFiles[filename].push(newLibrary)}}}}my.triggerEditor()}})}else{my.triggerEditor()}};my.triggerEditor=function(){var keywords=[];var builtinFunctions=[];var builtinConstants=[];for(var i=0;i<loadedLibs.length;i++){if(typeof cachedLibData[loadedLibs[i]]!=="undefined"){var data=cachedLibData[loadedLibs[i]];if(data.length!=="undefined"||data.length>0){if(data.hasOwnProperty("keywords")){keywords=keywords.concat(data["keywords"])}if(data.hasOwnProperty("builtinFunctions")){builtinFunctions=builtinFunctions.concat(data["builtinFunctions"])}if(data.hasOwnProperty("builtinConstants")){builtinConstants=builtinConstants.concat(data["builtinConstants"])}}}}keywords=my.deduplicateArray(keywords);builtinFunctions=my.deduplicateArray(builtinFunctions);builtinConstants=my.deduplicateArray(builtinConstants);window.codebenderModeLibrary=[];if(keywords.length>0){window.codebenderModeLibrary["keywords"]="|"+keywords.join("|")}else{window.codebenderModeLibrary["keywords"]=""}if(builtinFunctions.length>0){window.codebenderModeLibrary["builtinFunctions"]="|"+builtinFunctions.join("|")}else{window.codebenderModeLibrary["builtinFunctions"]=""}if(builtinConstants.length>0){window.codebenderModeLibrary["builtinConstants"]="|"+builtinConstants.join("|")}else{window.codebenderModeLibrary["builtinConstants"]=""}try{editor.aceEditor.getSession().setMode({path:editor.mode,v:Date.now()})}catch(e){my.loadCleanMode()}};my.deduplicateArray=function(arr){var a=arr.concat();for(var i=0;i<a.length;++i){for(var j=i+1;j<a.length;++j){if(a[i]===a[j]){a.splice(j--,1)}}}return a};my.getLoadedLibs=function(){return loadedLibs};my.getLibraryFiles=function(){return libraryFiles};my.getPersonalLibraries=function(){return personalLibraries};my.getPersonalLibraryFiles=function(){return personalLibraryFiles};my();return my}();editorLibrarySearch=function(aceEditor,projectView){var $editor=$(aceEditor.container);var Range=ace.require("ace/range").Range;var marker={id:null,row:null,t_start:null,t_end:null};var tokenConstantRe=/\s*<([a-zA-Z0-9._\/\+\(\)]+)>\s*/;var tokenStringRe=/\s*"([a-zA-Z0-9._\/\+\(\)]+)"\s*/;var systemLibraryRe=/(\s*#include\s+<)([a-zA-Z0-9._\/\+\(\)]+)>\s*/;var userLibraryRe=/(\s*#include\s+")([a-zA-Z0-9._\/\+\(\)]+)"\s*/;var tooltip={};tooltip.type=null;tooltip.mac='<p><kbd>⌘</kbd><span>+</span><i class="cb-icon-mouse-click"></i> <span class="library-search-view-file">to view file</span></p>';tooltip.other='<p><kbd>Ctrl</kbd><span>+</span><i class="cb-icon-mouse-click"></i> <span class="library-search-view-file">to view file</span></p>';tooltip.not_found="<p><span>File not detected</span></p>";tooltip.tag=null;tooltip.mode=null;var popover={};popover.content=null;popover.title=null;popover.enabled=false;var interval=window.setInterval(function(){if(typeof window.BrowserDetect!=="undefined"){window.clearInterval(interval);if(window.BrowserDetect.OS=="Mac"){tooltip.type="mac"}else{tooltip.type="other"}}},100);var tooltipTemplate='<div class="tooltip library-search-tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>';var tooltips=[];var popovers=[];var libraries={};var loadedLibs={};var personalLibraries={};var personalLibraryFiles={};var files={};var position={};var header=null;var headerName=null;var tooltipMode=null;var isModifierKeyPressed=false;var tooltipEnabled=false;var popoverLibraries=[];var libraryMode=null;var self=this;function getFoldsOffset(position,firstLine){var folds=editor.aceEditor.getSession().getAllFolds();var offset=0;folds.forEach(function(fold){var start=fold.range.start.row;var end=fold.range.end.row;if(start>=firstLine&&start<position&&end<position){offset+=end-start}});return offset}function changeScrollTopCallback(){self.removeMarker();self.clearTooltips();self.clearPopovers()}this.setSession=function(){editor.aceEditor.getSession().removeEventListener("changeScrollTop",changeScrollTopCallback);editor.aceEditor.getSession().on("changeScrollTop",changeScrollTopCallback)};this.check=function(e){libraries=editorSyntaxHighlighter.getLibraryFiles();loadedLibs=editorSyntaxHighlighter.getLoadedLibs();personalLibraries=editorSyntaxHighlighter.getPersonalLibraries();personalLibraryFiles=editorSyntaxHighlighter.getPersonalLibraryFiles();files=fileManager.getFiles();position=e.getDocumentPosition();var currentLine;var checkLine;var token=editor.aceEditor.getSession().getTokenAt(position.row,position.column);var flag=false;if(token!==null){header=null;var check=null;var t_start=null;var t_end=null;if(token.type=="constant"){check=tokenConstantRe.exec(token.value);currentLine=editor.aceEditor.getSession().getLine(position.row);checkLine=systemLibraryRe.exec(currentLine);if(check&&checkLine){header=check[1];t_start=token.start+1;t_end=t_start+header.length}tooltipMode="system"}else if(token.type=="string"){check=tokenStringRe.exec(token.value);currentLine=editor.aceEditor.getSession().getLine(position.row);checkLine=userLibraryRe.exec(currentLine);if(check&&checkLine){header=check[1];t_start=token.start+1;t_end=t_start+header.length}tooltipMode="project"}else if(token.type=="comment"||token.type=="comment.doc"){}else{currentLine=editor.aceEditor.getSession().getLine(position.row);check=systemLibraryRe.exec(currentLine);if(check!==null){header=check[2];t_start=check[1].length;t_end=t_start+header.length;tooltipMode="system"}else{check=userLibraryRe.exec(currentLine);if(check!==null){header=check[2];t_start=check[1].length;t_end=t_start+header.length;tooltipMode="project"}}}if(header!==null){var found;popoverLibraries=[];headerName=header.replace(".h","");tooltip.mode="not_found";libraryMode="not_found";if(tooltipMode=="system"){if(header in personalLibraryFiles){found=false;$.each(personalLibraryFiles[header],function(k,v){if(personalLibraries.indexOf(v.library)>-1){popoverLibraries.push(v);found=true}});if(found){tooltip.mode="found";libraryMode="personal"}}if(header in libraries){found=false;$.each(libraries[header],function(k,v){if(loadedLibs.indexOf(v.library)>-1){popoverLibraries.push(v);found=true}});if(found){tooltip.mode="found";libraryMode="system"}}}else if(tooltipMode=="project"){if(header in files){popoverLibraries.push({library:header,location:"sketch"});tooltip.mode="found";libraryMode="project"}if(header in personalLibraryFiles){found=false;$.each(personalLibraryFiles[header],function(k,v){if(personalLibraries.indexOf(v.library)>-1){popoverLibraries.push(v);found=true}});if(found){tooltip.mode="found";libraryMode="personal"}}if(header in libraries){found=false;$.each(libraries[header],function(k,v){if(loadedLibs.indexOf(v.library)>-1){popoverLibraries.push(v);found=true}});if(found){tooltip.mode="found";libraryMode="system"}}}if(position.column>=t_start&&position.column<=t_end){flag=true}}}if(flag){if(tooltip.mode=="found"){if(!popover.enabled){this.addMarker(position,t_start,t_end);tooltipEnabled=true}}else if(tooltip.mode=="not_found"){this.removeMarker();tooltipEnabled=false}if(marker.row!=position.row){marker.row=position.row;if(!popover.enabled){this.addTooltip(position.row)}}}else{marker.row=null;this.clearTooltips();this.removeMarker();tooltipEnabled=false}};this.addMarker=function(position,t_start,t_end){if(marker.id!==null){this.removeMarker()}var row=position.row;var firstLine=editor.aceEditor.getFirstVisibleRow();var range=new Range(row,t_start,row,t_end);marker.id=editor.aceEditor.getSession().addMarker(range,"library-search-marker","text");$editor.find(".library-search-row").removeClass("library-search-row");row-=getFoldsOffset(row,firstLine);var diff=row-firstLine;var row_tag=$editor.find(".ace_line")[diff];$(row_tag).addClass("library-search-row");aceEditor.setOption("enableMultiselect",false)};this.removeMarker=function(){if(marker.id!==null){editor.aceEditor.getSession().removeMarker(marker.id)}marker.id=null;$editor.find(".library-search-row").removeClass("library-search-row");aceEditor.setOption("enableMultiselect",true)};this.addTooltip=function(row){if(tooltips.length!=0){this.clearTooltips()}tooltip.tag=tooltip.not_found;if(tooltip.mode=="found"){if(tooltip.type=="mac"){tooltip.tag=tooltip.mac}else{tooltip.tag=tooltip.other}}var firstLine=editor.aceEditor.getFirstVisibleRow();row-=getFoldsOffset(row,firstLine);var diff=row-firstLine;var row_tag=$editor.find(".ace_line")[diff];var $span=$($(row_tag).find(".ace_constant, .ace_string").last());var coords=$span.offset();coords.top-=10;coords.left+=$span.width()+5;$(row_tag).tooltip({html:true,placement:"right",title:tooltip.tag,container:"body",template:tooltipTemplate,delay:{show:500,hide:0}}).tooltip("show");tooltips.push(row_tag);var $librarySearchTooltip=$(".library-search-tooltip");$librarySearchTooltip.css({left:coords.left,top:coords.top});if(tooltip.mode=="not_found"){$librarySearchTooltip.addClass("library-not-found")}};this.clearTooltips=function(){$.each(tooltips,function(k,v){$(v).tooltip("destroy")});tooltips=[];this.removeMarker()};function openPopup(library,location,target_header){var popupWindow=window.open("",location+"_"+library);popupWindow.focus();$.post(window.codebender.editor.librarySearch,{library:library,location:location,header:target_header},function(data){if(data.status){popupWindow.location=data.url}},"json")}function uniqueArray(input){var seen={};return input.filter(function(item){return seen.hasOwnProperty(item)?false:seen[item]=true})}this.addPopover=function(current_header){var content="";var sketch=[];var personal=[];var system=[];$.each(popoverLibraries,function(k,v){var tag='<a class="btn btn-mini library-search-popover-button" href="javascript:void(0);" data-target="'+v.library+'" data-location="'+v.location+'" data-header="'+current_header+'">'+v.library+"</a>";if(v.location=="sketch"){sketch.push(tag)}else if(v.location=="personal"){personal.push(tag)}else{system.push(tag)}});sketch=uniqueArray(sketch);personal=uniqueArray(personal);system=uniqueArray(system);if(sketch.length>0){content+='<tr class="library-search-category"><td class="library-search-category-title">Sketch</td><td class="library-search-category-content">'+sketch.join(" ")+"</td><tr/>"}if(personal.length>0){content+='<tr class="library-search-category"><td class="library-search-category-title">Personal libraries</td><td class="library-search-category-content">'+personal.join(" ")+"</td><tr/>"}if(system.length>0){content+='<tr class="library-search-category"><td class="library-search-category-title">Codebender libraries</td><td class="library-search-category-content">'+system.join(" ")+"</td><tr/>"}popover.content='<div class="library-search-popover-content"><table>'+content+"</table></div>";popover.title='<a class="library-search-popover-close pull-right" href="javascript:void(0);">&times;</a><p class="library-search-popover-title">File found in</p>';popover.enabled=true;var row=position.row;var col=editor.aceEditor.getSession().getLine(row).length;var coords=aceEditor.renderer.textToScreenCoordinates(row,col);var firstLine=editor.aceEditor.getFirstVisibleRow();row-=getFoldsOffset(row,firstLine);var diff=row-firstLine;var row_tag=$editor.find(".ace_line")[diff];$(row_tag).popover({html:true,placement:"right",title:popover.title,content:popover.content,container:"body",delay:{show:500,hide:0},trigger:"manual"}).popover("show");popovers.push(row_tag);$(".popover").css({left:coords.pageX+5+"px"});$(".library-search-popover-close").on("click",function(){$(row_tag).popover("hide").popover("destroy")});$(".library-search-popover-button").on("click",function(e){e.preventDefault();e.stopPropagation();var library=$(this).data("target");var location=$(this).data("location");var target_header=$(this).data("header");self.clearPopovers();self.log_library_search(library,location,target_header,true);if(location=="sketch"){aceEditor.setOption("enableMultiselect",true);selectFile(target_header)}else{openPopup(library,location,target_header)}})};this.clearPopovers=function(){$.each(popovers,function(k,v){$(v).popover("destroy")});popovers=[];popover.enabled=false};this.log_library_search=function(library,source,header,in_multiple){var msg={Library:library,"Library source":source,"Library header":header};if(in_multiple){msg["In multiple libraries"]=in_multiple}if(projectView){msg["InProjectView"]=true}var actionId=76;var metaData={message:msg};createLog(actionId,metaData)};aceEditor.on("mousemove",function(e){self.check(e);if(tooltipEnabled&&isModifierKeyPressed){$editor.find(".ace_content").addClass("library-search-enabled")}else{$editor.find(".ace_content").removeClass("library-search-enabled")}});aceEditor.on("mousedown",function(){self.clearTooltips();self.clearPopovers();var current_header=header;if(tooltipEnabled&&isModifierKeyPressed){$(window).trigger("library_search_off");aceEditor.setOption("enableMultiselect",false);var library;var location;if(libraryMode=="project"&&header in files&&!projectView){if(popoverLibraries.length>1){self.addPopover(current_header)}else{library="Project_"+$("#editor_heading_project_name").text();self.log_library_search(library,"sketch",header);aceEditor.setOption("enableMultiselect",true);selectFile(header)}}else if(libraryMode=="personal"&&header in personalLibraryFiles&&!projectView){if(popoverLibraries.length>1){self.addPopover(current_header)}else{library=popoverLibraries[0].library;location=popoverLibraries[0].location;self.log_library_search(library,location,header);openPopup(library,location,header)}}else if(libraryMode=="system"&&header in libraries&&!projectView){if(popoverLibraries.length>1){self.addPopover(current_header)}else{library=popoverLibraries[0].library;location=popoverLibraries[0].location;self.log_library_search(library,location,header);openPopup(library,location,header)}}else{var sketchFlag=false;var personalFlag=false;var systemFlag=false;popoverLibraries.forEach(function(current){if(current.location=="sketch"){sketchFlag=true}else if(current.location=="personal"){personalFlag=true}else if(current.location=="system"){systemFlag=true}});if(sketchFlag){library=$(".projectName").text();self.log_library_search(library,"sketch",current_header);aceEditor.setOption("enableMultiselect",true);selectFile(header)}else if((personalFlag||systemFlag)&&popoverLibraries.length>1){self.addPopover(current_header)}else{library=popoverLibraries[0].library;location=popoverLibraries[0].location;self.log_library_search(library,location,header);openPopup(library,location,header)}}}else{aceEditor.setOption("enableMultiselect",true)}});aceEditor.getSelection().on("changeCursor",function(){if(tooltipEnabled&&aceEditor.$mouseHandler.isMousePressed){aceEditor.getSelection().moveCursorTo(position.row,position.column,true)}});aceEditor.getSelection().on("changeSelection",function(){if(tooltipEnabled&&isModifierKeyPressed){editor.aceEditor.getSession().getSelection().clearSelection();$(window).trigger("library_search_off")}});$editor.on("mouseout",function(){marker.row=null;self.removeMarker();self.clearTooltips();$editor.find(".library-search-row").removeClass("library-search-row");$editor.find(".ace_content").removeClass("library-search-enabled");aceEditor.setOption("enableMultiselect",true);tooltipEnabled=false}).on("dblclick",function(){if(tooltipEnabled){aceEditor.getSelection().selectAWord()}}).on("keydown",function(e){if(e.keyCode==17){$(window).trigger("library_search_on")}});$(window).on("library_search_on",function(){isModifierKeyPressed=true;if(tooltipEnabled){$editor.find(".ace_content").addClass("library-search-enabled")}}).on("library_search_off",function(){isModifierKeyPressed=false;$editor.find(".ace_content").removeClass("library-search-enabled")});$("#container_left").on("click",function(){self.clearPopovers()})};editorHeaderDetection=function(files){this.cache={};var self=this;function changeCallback(){setTimeout(function(){self.update()},50)}this.setSession=function(){editor.aceEditor.getSession().removeEventListener("change",changeCallback);editor.aceEditor.getSession().on("change",changeCallback)};this.decodeHtml=function htmlEntities(str){return String(str).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')};this.log=function(){var actionId=82;var metaData={message:this.cache};createLog(actionId,metaData)};this.jsObjClone=function(obj){var objcopy={};for(var i in obj){if(obj.hasOwnProperty(i)){objcopy[i]=obj[i]}}return objcopy};this.checkCache=function(a,b){var aProps=Object.keys(a);var bProps=Object.keys(b);if(aProps.length!=bProps.length){return false}for(var i=0;i<aProps.length;i++){var propName=aProps[i];if(a[propName].length!=b[propName].length){return false}if(!a[propName].every(function(element,index){return element===b[propName][index]})){return false}}return true};this.findHeaders=function(text_body){var text_lines=text_body.split("\n");var line_count=text_lines.length;var re_header=/^[\/\*\s]*#\s*include\s*[<"]{1}\s*([a-zA-Z0-9_+\/]*\.h)\s*[>"]{1}[\s\/\*]*/;var headers=[];for(var i=0;i<line_count;i++){if(re_header.test(text_lines[i])){var library=re_header.exec(text_lines[i])[1];if(headers.indexOf(library)==-1){headers.push(library)}}}return headers};this.update=function(){var cache=this.jsObjClone(this.cache);var text_body=editor.aceEditor.getSession().getValue();cache[fileManager.openFname]=this.findHeaders(text_body);if(!this.checkCache(cache,this.cache)){this.cache=cache;this.log()}};eventManager.addListener("addFile",function(param1,param2){if(!self.cache.hasOwnProperty(param1)){var cache=self.jsObjClone(self.cache);cache[param1]=self.findHeaders(self.decodeHtml(param2));if(!self.checkCache(cache,self.cache)){self.cache=cache;self.log()}}});eventManager.addListener("removeFile",function(param){if(self.cache.hasOwnProperty(param)){delete self.cache[param];self.log()}});eventManager.addListener("renameFile",function(param1,param2){if(self.cache.hasOwnProperty(param1)){self.cache[param2]=self.cache[param1];delete self.cache[param1];self.log()}});var triggerLog=false;$.each(files,function(k,v){var content=self.decodeHtml(v);var headers=self.findHeaders(content);if(headers.length>0){triggerLog=true}if(!self.cache.hasOwnProperty(k)){self.cache[k]=headers}});if(triggerLog){self.log()}};editorDummyHeaderDetection=function(){this.cache={};var self=this;function changeCallback(){setTimeout(function(){self.update()},50)}this.setSession=function(){editor.aceEditor.getSession().removeEventListener("change",changeCallback);editor.aceEditor.getSession().on("change",changeCallback)};this.log=function(){var actionId=83;var metaData={message:Object.keys(this.cache)};createLog(actionId,metaData)};this.jsObjEquals=function(obj1,obj2){var i;for(i in obj1){if(!obj2.hasOwnProperty(i)){return false}if(obj1[i]!=obj2[i]){return false}}for(i in obj2){if(!obj1.hasOwnProperty(i)){return false}if(obj1[i]!=obj2[i]){return false}}return true};this.update=function(){var cache={};var text_body=editor.aceEditor.getSession().getValue();var text_lines=text_body.split("\n");var line_count=text_lines.length;var re_header=/^[\/\*\s]*#\s*include\s*[<"]{1}\s*(.+\.h)\s*[>"]{1}[\s\/\*]*/;for(var i=0;i<line_count;i++){if(re_header.test(text_lines[i])){var library=re_header.exec(text_lines[i])[1];if(!cache.hasOwnProperty(library)){cache[library]=true}}}if(!this.jsObjEquals(cache,this.cache)){this.cache=cache;this.log()}}};
var ewDraggable={};ewDraggable.yes=false;ewDraggable.width=12;var nsDraggable={};nsDraggable.yes=false;nsDraggable.height=12;var remember={};remember.mcheight=0;remember.cbwidth=0;remember.bheight=0;remember.theight=0;remember.tbottom=0;remember.nsdtop=0;remember.smwidth=0;remember.cpwidth=0;remember.compilerOutputOpen=false;function open_compiler(){var $serialMonitor=$("#serial_monitor");var $compilerContainer=$("#compiler_container");var $containerTop=$("#container_top");var $containerBottom=$("#container_bottom");var $containerLeft=$("#container_left");if($serialMonitor.is(":visible")){var compilerContainerCSS={display:"block",width:remember.cpwidth};var serialMonitorCSS={width:remember.smwidth};var ewDraggableHandleCSS={display:"block",left:remember.smwidth};if(remember.smwidth==0){var containerBottomWidth=$containerBottom.width();compilerContainerCSS.width=(containerBottomWidth-ewDraggable.width)/2;serialMonitorCSS.width=(containerBottomWidth-ewDraggable.width)/2;ewDraggableHandleCSS.left=(containerBottomWidth-ewDraggable.width)/2}$compilerContainer.css(compilerContainerCSS);$serialMonitor.css(serialMonitorCSS);$("#ew_draggable_handle").css(ewDraggableHandleCSS);$serialMonitor.addClass("draggable");ewDraggable.yes=true;$containerLeft.find(".sidebar_wrapper").getNiceScroll().resize();remember.compilerOutputOpen=true;editor.aceEditor.resize();return}var containerBottomCSS={visibility:"visible",height:remember.bheight};$containerBottom.css(containerBottomCSS);var containerTopCSS={bottom:remember.tbottom};$containerTop.css(containerTopCSS);$compilerContainer.css({display:"block"});var nsDraggableHandleCSS={display:"block",top:remember.theight+remember.ns_offset};$("#ns_draggable_handle").css(nsDraggableHandleCSS);nsDraggable.yes=true;$containerLeft.find(".sidebar_wrapper").getNiceScroll().resize();remember.compilerOutputOpen=true;editor.aceEditor.resize()}function close_compiler(){if(!remember.compilerOutputOpen){return}if(ewDraggable.yes){$("#serial_monitor").css({width:""}).removeClass("draggable");ewDraggable.yes=false}else{$("#container_top, #container_bottom, #ns_draggable_handle").removeAttr("style");nsDraggable.yes=false}$("#compiler_container, #ew_draggable_handle").removeAttr("style");$("#container_left").find(".sidebar_wrapper").getNiceScroll().resize();remember.compilerOutputOpen=false;editor.aceEditor.resize()}function toggle_serial_monitor(){if($("#serial_monitor").is(":visible")){close_serial_monitor()}else{open_serial_monitor()}}function open_serial_monitor_keybinding(){if(!$("#serial_monitor").is(":visible")){open_serial_monitor()}}function open_serial_monitor(){var $serialBtn=$("#serial_btn");var $serialMonitor=$("#serial_monitor");var $compilerContainer=$("#compiler_container");var $containerTop=$("#container_top");var $containerBottom=$("#container_bottom");var $containerLeft=$("#container_left");var $nsDraggableHandle=$("#ns_draggable_handle");var $ewDraggableHandle=$("#ew_draggable_handle");$("#serial_monitor_toggle").addClass("active");if($serialBtn.hasClass("connected")){if(ewDraggable.yes){$compilerContainer.css({width:""});ewDraggable.yes=false}else{$containerTop.removeAttr("style");$containerBottom.removeAttr("style");$nsDraggableHandle.removeAttr("style");nsDraggable.yes=false}$serialMonitor.removeAttr("style");$ewDraggableHandle.removeAttr("style");$serialMonitor.removeClass("draggable");$serialBtn.find("i").removeClass().addClass("icon-list-alt");$serialBtn.find(".text-large").html("Serial Monitor");$serialBtn.removeClass("connected");resizeSerialOutput();$containerLeft.find(".sidebar_wrapper").getNiceScroll().resize();editor.aceEditor.resize();return}if($compilerContainer.is(":visible")){var serialMonitorCSS={display:"block",width:remember.smwidth};var compilerContainerCSS={width:remember.cpwidth};var ewDraggableHandleCSS={display:"block",left:remember.smwidth};if(remember.smwidth==0){serialMonitorCSS.width=($containerBottom.width()-ewDraggable.width)/2;compilerContainerCSS.width=($containerBottom.width()-ewDraggable.width)/2;ewDraggableHandleCSS.left=($containerBottom.width()-ewDraggable.width)/2}$serialMonitor.css(serialMonitorCSS);$compilerContainer.css(compilerContainerCSS);$ewDraggableHandle.css(ewDraggableHandleCSS);$serialMonitor.addClass("draggable");ewDraggable.yes=true}else{var containerBottomCSS={visibility:"visible",height:remember.bheight};$containerBottom.css(containerBottomCSS);var containerTopCSS={bottom:remember.tbottom};$containerTop.css(containerTopCSS);$serialMonitor.css({display:"block"});var nsDraggablehandleCSS={display:"block",top:remember.theight+remember.ns_offset};$nsDraggableHandle.css(nsDraggablehandleCSS);nsDraggable.yes=true}$serialBtn.find("i").removeClass().addClass("icon-unlink");$serialBtn.find(".text-large").html("Disconnect");$serialBtn.addClass("connected");resizeSerialOutput();$containerLeft.find(".sidebar_wrapper").getNiceScroll().resize();editor.aceEditor.resize()}function close_serial_monitor(){var $serialBtn=$("#serial_btn");var $serialMonitor=$("#serial_monitor");if(compilerflasher.pluginHandler.connected){compilerflasher.pluginHandler.disconnect()}$("#serial_monitor_toggle").removeClass("active");if(ewDraggable.yes){$("#compiler_container").css({width:""});$serialMonitor.removeClass("draggable");ewDraggable.yes=false}else{$("#container_top, #container_bottom, #ns_draggable_handle").removeAttr("style");nsDraggable.yes=false}$serialMonitor.removeAttr("style");$("#ew_draggable_handle").removeAttr("style");$serialBtn.find("i").removeClass().addClass("icon-list-alt");$serialBtn.find(".text-large").html("Serial Monitor");$serialBtn.removeClass("connected");$("#container_left").find(".sidebar_wrapper").getNiceScroll().resize();editor.aceEditor.resize()}function resizeSerialOutput(){$("#serial_monitor_output").css({height:$("#serial-wrapper").height()-$("#user_input").height()-3})}function toggle_sidebar(){if($("#container_left").hasClass("noshow")){open_sidebar()}else{close_sidebar()}}function open_sidebar(){var $containerLeft=$("#container_left");$("#info-bar").removeClass("no-sidebar");$containerLeft.stop(true).removeClass("noshow");$("#container_right").stop(true).animate({left:"205px"},500,function(){$containerLeft.animate({height:"100%"},500,function(){$containerLeft.find(".sidebar_wrapper").niceScroll({cursorcolor:"#E0E0E0",autohidemode:false,horizrailenabled:false});editor.aceEditor.resize()})});$("#files_list").niceScroll({cursorcolor:"#E0E0E0",autohidemode:false,horizrailenabled:false,railpadding:{right:6}});$("#toggle_sidebar").find("i").removeClass().addClass("icon-caret-left")}function close_sidebar(){var $containerLeft=$("#container_left");var $containerRight=$("#container_right");var $sidebarWrapper=$containerLeft.find(".sidebar_wrapper");$("#info-bar").addClass("no-sidebar");$sidebarWrapper.scrollTop(0);$containerRight.stop(true);$containerLeft.stop(true).animate({height:"36px"},500,function(){$containerRight.animate({left:0},500,function(){$("#files_list").getNiceScroll().remove();editor.aceEditor.resize()})});$containerLeft.addClass("noshow");$("#toggle_sidebar").find("i").removeClass().addClass("icon-caret-right");$sidebarWrapper.getNiceScroll().remove()}function advanced_options(){var $menuBar=$("#menu-bar");var $advancedOptions=$("#advanced_options");var $cbCfFlashBtn=$("#cb_cf_flash_btn");var $cbCfVerifyBtn=$("#cb_cf_verify_btn");var $save=$("#save");var $serialMonitorToggle=$("#serial_monitor_toggle");if($menuBar.hasClass("advanced")){$menuBar.removeClass("advanced").addClass("no-advanced");$advancedOptions.removeClass("shown");var btnswna=$cbCfFlashBtn.outerWidth(true)+$cbCfVerifyBtn.outerWidth(true)+$save.outerWidth(true)+$serialMonitorToggle.outerWidth(true)+$advancedOptions.outerWidth(true)+12;var nasw=($menuBar.width()-btnswna)/2;var $menuBarNoAdvanced=$("#menu-bar.no-advanced");$menuBarNoAdvanced.find("#cb_cf_ports").css({width:nasw});$menuBarNoAdvanced.find("#cb_cf_boards").css({width:nasw});return}$menuBar.removeClass("no-advanced").addClass("advanced");$advancedOptions.addClass("shown");var btnswad=$cbCfFlashBtn.outerWidth(true)+$cbCfVerifyBtn.outerWidth(true)+$save.outerWidth(true)+$serialMonitorToggle.outerWidth(true)+$("#cb_cf_programmers").outerWidth(true)+$("#cb_cf_flash_with_prog_btn").outerWidth(true)+$advancedOptions.outerWidth(true)+12;var asw=($menuBar.width()-btnswad)/2;var $menuBarAdvanced=$("#menu-bar.advanced");$menuBarAdvanced.find("#cb_cf_ports").css({width:asw});$menuBarAdvanced.find("#cb_cf_boards").css({width:asw})}function calcNsOffset(){return parseInt($("#main-container").css("padding-top"),10)}function resizable_elements(){var $containerBottom=$("#container_bottom");var $containerTop=$("#container_top");var $ewDraggableHandle=$("#ew_draggable_handle");var $nsDraggableHandle=$("#ns_draggable_handle");var $serialMonitor=$("#serial_monitor");var $compilerContainer=$("#compiler_container");var $mainContainer=$("#main-container");var containerBottomWidth=$containerBottom.width();var maxw=parseInt(containerBottomWidth*.44,10);var minw=parseInt(containerBottomWidth*.28,10);var offset=$containerBottom.offset();var splitter=function(event,ui){remember.cbwidth=$containerBottom.width();remember.smwidth=ui.position.left;remember.cpwidth=remember.cbwidth-(remember.smwidth+ewDraggable.width);$serialMonitor.css({width:remember.smwidth});$compilerContainer.css({width:remember.cpwidth})};$ewDraggableHandle.draggable({axis:"x",containment:[offset.left+minw,offset.top,minw+maxw,offset.top+$containerBottom.height()],drag:splitter});var nssplitter=function(event,ui){remember.mcheight=$mainContainer.height();var mainContainerPaddingTop=parseInt($mainContainer.css("padding-top"),10);var mainContainerPaddingBottom=parseInt($mainContainer.css("padding-bottom"),10);remember.tbottom=remember.mcheight-ui.position.top+mainContainerPaddingTop+mainContainerPaddingBottom;remember.bheight=remember.mcheight-ui.position.top-nsDraggable.height+mainContainerPaddingTop;$containerBottom.css({height:remember.bheight});$containerTop.css({bottom:remember.tbottom});$("#container_left").find(".sidebar_wrapper").getNiceScroll().resize();remember.theight=$containerTop.height();remember.nsdtop=ui.position.top;resizeSerialOutput();editor.aceEditor.resize()};remember.mcheight=$mainContainer.height();$nsDraggableHandle.draggable({axis:"y",containment:[0,$containerTop.offset().top+remember.mcheight*.2,$mainContainer.width(),remember.mcheight*.9],drag:nssplitter,stop:nssplitter});var mainContainerPaddingTop=parseInt($mainContainer.css("padding-top"),10);var mainContainerPaddingBottom=parseInt($mainContainer.css("padding-bottom"),10);remember.bheight=remember.mcheight/2-nsDraggable.height;remember.theight=remember.mcheight-remember.bheight-nsDraggable.height;remember.tbottom=remember.theight+mainContainerPaddingTop-mainContainerPaddingBottom+nsDraggable.height/2;remember.nsdtop=remember.theight+nsDraggable.height;$(window).resize(function(){var newcbwidth=parseInt($containerBottom.width(),10);var percsm=50;if(remember.cbwidth>0){percsm=remember.smwidth*100/remember.cbwidth}var newsmw=percsm*newcbwidth/100;offset=$containerBottom.offset();maxw=newcbwidth*.44;minw=newcbwidth*.28;if(newsmw<minw){newsmw=minw}else if(newsmw>minw+maxw){newsmw=minw+maxw}containerBottomWidth=newcbwidth;remember.smwidth=newsmw;remember.cpwidth=newcbwidth-(newsmw+ewDraggable.width);remember.cbwidth=newcbwidth;$ewDraggableHandle.draggable("option","containment",[offset.left+minw,offset.top,minw+maxw,offset.top+$containerBottom.height()]);if(ewDraggable.yes){var serialMonitorCSS={width:newsmw};var compilerContainerCSS={width:newcbwidth-(newsmw+ewDraggable.width)};var ewDraggableHandleCSS={left:newsmw};if(remember.smwidth==0){serialMonitorCSS.width=(newcbwidth-ewDraggable.width)/2;compilerContainerCSS.width=(newcbwidth-ewDraggable.width)/2;ewDraggableHandleCSS.left=(newcbwidth-ewDraggable.width)/2}$serialMonitor.css(serialMonitorCSS);$compilerContainer.css(compilerContainerCSS);$ewDraggableHandle.css(ewDraggableHandleCSS)}remember.ns_offset=calcNsOffset();var mainContainerHeight=$mainContainer.height();var pernsd=remember.nsdtop*100/remember.mcheight;var newnsd=pernsd*mainContainerHeight/100;var nsDraggableTopMax=$containerTop.offset().top+mainContainerHeight*.2;var nsDraggableTopMin=mainContainerHeight*.9;var expectedHeightBottom=mainContainerHeight-newnsd;var minimumHeight=mainContainerHeight-nsDraggableTopMin+$containerTop.offset().top;if(expectedHeightBottom<minimumHeight){newnsd-=minimumHeight-expectedHeightBottom}var mainContainerPaddingTop=parseInt($mainContainer.css("padding-top"),10);var mainContainerPaddingBottom=parseInt($mainContainer.css("padding-bottom"),10);var newctb=mainContainerHeight-newnsd+mainContainerPaddingTop+mainContainerPaddingBottom-remember.ns_offset;var newcbh=mainContainerHeight-newnsd-nsDraggable.height+mainContainerPaddingTop-remember.ns_offset;$nsDraggableHandle.draggable("option","containment",[0,nsDraggableTopMax,$mainContainer.width(),nsDraggableTopMin]);var nsTop=newnsd+remember.ns_offset;remember.bheight=newcbh;remember.tbottom=newctb;remember.theight=nsTop-remember.ns_offset;if(nsDraggable.yes){var containerTopCSS={bottom:newctb};var containerBottomCSS={height:newcbh};var nsDraggableHandle={top:nsTop};if(remember.nsdtop==0){containerTopCSS.bottom=212;containerBottomCSS.height=150;nsDraggableHandle.top=$containerTop.height()+remember.ns_offset}$containerTop.css(containerTopCSS);$containerBottom.css(containerBottomCSS);$nsDraggableHandle.css(nsDraggableHandle);resizeSerialOutput();$("#container_left").find(".sidebar_wrapper").getNiceScroll().resize();editor.aceEditor.resize()}})}function printCurrentFile(){ace.require("ace/config").loadModule("ace/ext/static_highlight",function(m){var result=m.renderSync(editor.aceEditor.getValue(),editor.aceEditor.session.getMode(),editor.aceEditor.renderer.theme);var printCodeContainer=document.getElementById("print-code-container");ace.require("ace/lib/dom").setInnerHtml(printCodeContainer,result.html);ace.require("ace/lib/dom").importCssString(result.css);var sketchName=$("#editor_heading_project_name").text();var fileName=fileManager.openFname;$("#print-sketch-name").text(sketchName);$("#print-file-name").text(fileName);setTimeout(function(){window.print()},10)})}$(function(){var $sidebarWrapper=$("#container_left").find(".sidebar_wrapper");var $filesList=$("#files_list");$('[data-toggle="tooltip"]').tooltip();$sidebarWrapper.niceScroll({cursorcolor:"#E0E0E0",autohidemode:false,horizrailenabled:false});$sidebarWrapper.on("scroll",function(){$filesList.getNiceScroll().resize()});$filesList.niceScroll({cursorcolor:"#E0E0E0",autohidemode:false,horizrailenabled:false,railpadding:{right:5}});remember.ns_offset=calcNsOffset();var $cbCfFlashBtn=$("#cb_cf_flash_btn");var $cbCfVerifyBtn=$("#cb_cf_verify_btn");var $save=$("#save");var $serialMonitorToggle=$("#serial_monitor_toggle");var $advancedOptions=$("#advanced_options");var $menuBar=$("#menu-bar");if($("#container_bottom").length>0){resizable_elements();$(window).resize(function(){var btnswna=$cbCfFlashBtn.outerWidth(true)+$cbCfVerifyBtn.outerWidth(true)+$save.outerWidth(true)+$serialMonitorToggle.outerWidth(true)+$advancedOptions.outerWidth(true)+12;var nasw=($menuBar.width()-btnswna)/2;var btnswad=$cbCfFlashBtn.outerWidth(true)+$cbCfVerifyBtn.outerWidth(true)+$save.outerWidth(true)+$serialMonitorToggle.outerWidth(true)+$("#cb_cf_programmers").outerWidth(true)+$("#cb_cf_flash_with_prog_btn").outerWidth(true)+$advancedOptions.outerWidth(true)+14;var asw=($menuBar.width()-btnswad)/2;var $menuBarAdvanced=$("#menu-bar.advanced");$menuBarAdvanced.find("#cb_cf_ports").css({width:asw});$menuBarAdvanced.find("#cb_cf_boards").css({width:asw});var $menyBarNoAdvanced=$("#menu-bar.no-advanced");$menyBarNoAdvanced.find("#cb_cf_ports").css({width:nasw});$menyBarNoAdvanced.find("#cb_cf_boards").css({width:nasw})})}$(window).load(function(){var btnswna=$cbCfFlashBtn.outerWidth(true)+$cbCfVerifyBtn.outerWidth(true)+$save.outerWidth(true)+$serialMonitorToggle.outerWidth(true)+$advancedOptions.outerWidth(true)+12;var nasw=($menuBar.width()-btnswna)/2;var $menuBarNoAdvanced=$("#menu-bar.no-advanced");$menuBarNoAdvanced.find("#cb_cf_ports").css({width:nasw});$menuBarNoAdvanced.find("#cb_cf_boards").css({width:nasw})});if(window.inEditorView){init()}});
editorbridge=function(real){this.real=real;var self=this;function errorHandler(callback){var toReturn={success:false,message:"Unexpected error occurred. Try again later."};callback(toReturn)}function createRequest(url,data,callback){$.ajax({method:"POST",url:url,data:data}).done(function(data){callback(data)}).fail(function(){errorHandler(callback)})}function handleOperation(url,requestData,callback){if(self.real){createRequest(url,requestData,function(responseData){self.handleResponse(responseData,callback)});return}self.fakeHandleResponse(callback)}this.fakeHandleResponse=function(callback){var toReturn={};toReturn.success=true;setTimeout(function(){callback(toReturn)},200)};this.handleResponse=function(data,callback){var toReturn={};try{var response=data;if(typeof response==="string"){response=JSON.parse(data)}if(response.success){toReturn.success=true;if(typeof response.message!=="undefined"){toReturn.message=response.message}callback(toReturn);return}toReturn.success=false;if(typeof response.error!=="undefined"){toReturn.message=response.error}else{toReturn.message="An unexpected error has occured. Please try again."}callback(toReturn)}catch(error){errorHandler(callback)}};this.createFile=function(name,callback){handleOperation(window.codebender.editor.createFile,{data:JSON.stringify(name)},callback)};this.deleteFile=function(name,callback){handleOperation(window.codebender.editor.deleteFile,{data:JSON.stringify(name)},callback)};this.renameFile=function(data,callback){handleOperation(window.codebender.editor.renameFile,data,callback)};this.changeProjectName=function(name,callback){handleOperation(window.codebender.editor.setProjectName,{data:name},callback)};this.save=function(files,callback){handleOperation(window.codebender.editor.saveCode,{data:files},callback)};this.editDescription=function(data,callback){var path=window.codebender.editor.setProjectDescripion;if(data.hasOwnProperty("shortDescription")){path=window.codebender.editor.descriptionEditorSave}handleOperation(path,data,callback)}};
function init(){window.converter=new Markdown.Converter;$.ajaxSetup({cache:false});$.getScript(window.codebender.editor.astyle).done(function(){var js_format_string=Module.cwrap("js_format_string","string",["string"]);autoFormat=function(){var placeholder="codebender_reformat_cursor";var old_position=editor.aceEditor.getCursorPosition();var old_code_lines=editor.aceEditor.getSession().getValue().split("\n");old_code_lines[old_position.row]=old_code_lines[old_position.row].slice(0,old_position.column)+placeholder+old_code_lines[old_position.row].slice(old_position.column);var formatted_lines=js_format_string(old_code_lines.join("\n")).split("\n");for(var i=0;i<formatted_lines.length;i++){var index=formatted_lines[i].indexOf(placeholder);if(index!==-1){formatted_lines[i]=formatted_lines[i].substring(0,index)+formatted_lines[i].substring(index+placeholder.length,formatted_lines[i].length);editor.aceEditor.getSession().setValue(formatted_lines.join("\n"));editor.aceEditor.getSession().getSelection().selectionLead.setPosition(i,index);editor.aceEditor.focus();break}}fileManager.showAnotations(fileManager.openFname)};$.ajaxSetup({cache:false})});var files=window.codebender.editor.files;window.editor=new editor("editor",files);window.fileManager=new fileManager(files);window.editorbridge=new editorbridge(window.inRealEditor);var initInterval=setInterval(function(){if(!window.compilerflasherStart){return}clearInterval(initInterval);window.compilerflasherInitialized=false;window.compilerflasher=new compilerflasher(function(){return fileManager.getFiles()});window.compilerflasherInitialized=true;compilerflasher.on("pre_verify",before_verification);compilerflasher.on("verification_succeed",verification_onSuccess);compilerflasher.on("verification_failed",verification_onFail);compilerflasher.on("pre_flash",before_flash);compilerflasher.on("mid_flash",mid_flash);compilerflasher.on("flash_failed",flash_onFail);compilerflasher.on("flash_succeed",flash_onSuccess);compilerflasher.on("pre_hex",before_verification);compilerflasher.on("hex_succeed",hex_success);compilerflasher.on("hex_failed",verification_onFail);compilerflasher.on("plugin_notification",setOperationOutput);compilerflasher.on("plugin_running",clearOperationOutput)},50);var $filesList=$("#files_list");function scrollToFile(filename){var $file=$filesList.find('.filelist[data-name="'+filename+'"]').parent();if($file.length>0){$filesList.scrollTop(0);var fileTop=$file.position().top;$filesList.scrollTop(fileTop)}}eventManager.addListener("addFile",function(fname,content){fileManager.addFile(fname,content);refreshFileList(fileManager.getFiles());selectFile(fname);scrollToFile(fname);if(window.collaborationEnabled&&sharejsManager.enabled){eventManager.fire("addFileCollaboration")}});eventManager.addListener("removeFile",function(fname){fileManager.removeFile(fname);refreshFileList(fileManager.getFiles());var filenameToSelect=fileManager.openFname;if(fileManager.openFname==fname){filenameToSelect=fileManager.inoFname}selectFile(filenameToSelect);scrollToFile(filenameToSelect);if(window.collaborationEnabled&&sharejsManager.enabled){eventManager.fire("removeFileCollaboration",fname)}});eventManager.addListener("renameFile",function(old_fname,new_fname){fileManager.renameFile(old_fname,new_fname);refreshFileList(fileManager.getFiles());if(fileManager.openFname==old_fname){selectFile(new_fname)}else{selectFile(fileManager.openFname)}if(window.collaborationEnabled&&sharejsManager.enabled){eventManager.fire("renameFileCollaboration",old_fname,new_fname)}});eventManager.addListener("selectFile",function(fname){if(window.collaborationEnabled&&sharejsManager.enabled){sharejsManager.openFile(fname)}else{fileManager.openFile(fname)}editor.aceEditor.focus()});eventManager.addListener("saveSketch",function(){fileManager.saveState();if(window.collaborationEnabled&&sharejsManager.enabled){eventManager.fire("saveSketchCollaboration")}});eventManager.addListener("file-opened",function(){if(typeof hideEditorLoadingScreen==="function"){hideEditorLoadingScreen()}});if(window.collaborationEnabled){$("#collaboration-status").show().css("color","#ff0000");$("#collaboration").tooltip({placement:"top",title:"Collaboration disabled"}).tooltip("show");var scriptSources=window.codebender.editor.sharejsScripts;function getScriptCallback(){scriptCounter++;if(scriptCounter>=scriptSources.length){var dependenciesFetched=true;sharejsManagerCallback(dependenciesFetched)}else{getScript(scriptSources[scriptCounter])}}function sharejsManagerCallback(dependenciesFetched){var collaboration=window.codebender.editor.collaboration;window.sharejsManager=new SharejsManager(collaboration.shareHost,collaboration.shareHash,collaboration.userId,collaboration.projectId);sharejsManager.init(dependenciesFetched)}var scriptCounter=0;function getScript(scriptSource){var script=document.createElement("script");script.async=true;document.body.appendChild(script);script.onload=function(){getScriptCallback()};script.onerror=function(){var dependenciesFetched=false;sharejsManagerCallback(dependenciesFetched)};script.src=scriptSource}getScript(scriptSources[scriptCounter])}else{refreshFileList(files);selectFile(fileManager.inoFname)}editor.addCommands();editor.setReadOnly(false);addWindowCommands();window.binary=null;$(document).on("keydown",function(event){if($(event.target).is("#search")||$(event.target).is(".ace_text-input")||$(event.target).is("#createfield")||$(event.target).is("#newFilename")||$(event.target).is("#description-editor")||$(event.target).is("#short-description-modal-input")||$(event.target).is("#editor_heading_project_name input")||$(event.target).is("#text2send")||$(event.target).is(".ace_search_field")||$(event.target).closest("#habla_window_div").length>0){return}else if(event.keyCode==8){event.preventDefault();event.stopPropagation()}});$("#menu-bar").on("click",function(event){$(event.target).tooltip("hide")});window.skipUnloadCheck=false;window.onbeforeunload=function(){if(window.inRealEditor){if(window.skipUnloadCheck){window.skipUnloadCheck=false;return}if(!fileManager.isStateSaved()){return"You have UNSAVED CHANGES in your project. If you leave now, your changes WILL BE LOST."}if(window.collaborationEnabled&&sharejsManager.enabled){sharejsManager.closeAllConnections()}}if($("#uploadusb").prop("disabled")===true){return"There is an on-going flashing operation."}var actionId=78;var metaData={tabID:compilerflasher.pluginHandler.tabID};createLog(actionId,metaData)};$("#download").on("click",function(){if(!fileManager.isStateSaved()){var check=confirm("You have unsaved changes that will not be included into your download. Do you wish to proceed?");if(!check){$("#download_menu").dropdown("toggle");return false}}window.skipUnloadCheck=true});$("#hexdownload").on("click",function(){window.skipUnloadCheck=true});$("#delete").on("click",function(){window.skipUnloadCheck=true});var $embedInfo=$("#embed_info");if(window.isPublic){$embedInfo.show()}else{$embedInfo.hide()}$("#editor").find(".ui-resizable-handle").hide();Dropzone.options.dropzoneForm={paramName:"file",maxFilesize:2,url:window.codebender.editor.oneUploaderEndPoint,dictDefaultMessage:'<span id="dropzone-title">Drop your files here!</span><br><span id="dropzone-subtitle">(Or click to select file)</span>',success:function(file,response){if(!response.success){$("#file_upload_warning_message").text(response.error);$("#file_upload_warning").show(200);var node,_i,_len,_ref,_results;file.previewElement.classList.add("dz-error");var message=response.error;_ref=file.previewElement.querySelectorAll("[data-dz-errormessage]");_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){node=_ref[_i];_results.push(node.textContent=message)}return _results}else{$("#file_upload_warning").hide(200);eventManager.fire("addFile",response.filename,decodeHtml(response.code));return file.previewElement.classList.add("dz-success")}},error:function(file,errorMsg){$("#file_upload_warning_message").text(errorMsg);$("#file_upload_warning").show(200);file.previewElement.classList.add("dz-error");file.previewElement.querySelector("[data-dz-errormessage]").textContent=errorMsg;return file.previewElement}};if(window.inRealEditor){var title="This project is Private. Double click to make it Public.";if(window.isPublic){title="This project is Public. Double click to make it Private."}var $editorHeadingPrivacyIcon=$("#editor_heading_privacy_icon");$editorHeadingPrivacyIcon.dblclick(function(){$editorHeadingPrivacyIcon.addClass("inprogress");changePrivacy("editor")}).tooltip({placement:"right",title:title,container:"body",delay:{show:200,hide:100}})}$("#show_keyboard_hotkeys").tooltip();$("#reformat_code").tooltip();headingProject();if(!window.inRealEditor){init_guide()}}var $editorHeadingProjectName=$("#editor_heading_project_name");var $editorHeadingProjectWorking=$("#editor_heading_project_working");var editorHeadingTooltipOptions={placement:"bottom",container:"body",template:'<div class="tooltip editor-heading-project-tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',delay:{show:200,hide:100}};var editorHeadingProjectTooltipTitle="Click to rename: ";function headingProject(){$editorHeadingProjectName.editable(function(value){window.saveOrRenameOperation=true;var oldName=this.revert.trim();var newName=value.trim();if(oldName==newName||newName.length===0){return oldName}$editorHeadingProjectName.tooltip("destroy");$editorHeadingProjectWorking.css("display","inline-block");$editorHeadingProjectName.addClass("inprogress").tooltip("hide");editorbridge.changeProjectName(newName,function(changed){$editorHeadingProjectWorking.hide();$editorHeadingProjectName.removeClass("inprogress");if(changed.success){setOperationOutput('<i class="icon-ok"></i> Name successfully changed!');eventManager.fire("renameFile",oldName+".ino",newName+".ino");document.title=newName+" : codebender";$editorHeadingProjectName.data("title",editorHeadingProjectTooltipTitle+newName).tooltip("destroy").tooltip(editorHeadingTooltipOptions)}else{setOperationOutput('<i class="icon-remove"></i> '+changed.message);$editorHeadingProjectName.data("title",editorHeadingProjectTooltipTitle+oldName).tooltip("destroy").tooltip(editorHeadingTooltipOptions);$editorHeadingProjectName.text(oldName)}window.saveOrRenameOperation=false});return newName},{type:"text",style:"inherit",submit:'<i class="icon-ok"></i>',cancel:'<i class="icon-remove"></i>',onblur:"cancel"}).tooltip(editorHeadingTooltipOptions).on("click",function(){$editorHeadingProjectName.tooltip("hide")}).on("click.editable",function(event){if($(event.toElement).hasClass("icon-ok")){this.reset()}})}function noQuote(text){return text.replace(/'/g,"\\x27")}function disableDeleteModalButtons(){if(window.collaborationEnabled&&sharejsManager.enabled){eventManager.fire("deleteSketchCollaboration")}var $deleteProjectButton=$("#deleteProjectButton");$deleteProjectButton.html('<i class="icon-spinner icon-spin"></i> Working...</a>');$deleteProjectButton.addClass("disabled");$deleteProjectButton.css("pointer-events","none");$("#cancelDeleteProjectButton").hide()}function renameFilenameModal(filename){$("#oldFilename").val(filename);$("#newFilename").val(filename);$("#filenameModal").modal("show")}function renameFilename(){setOperationProgress(90);var oldFileName=$("#oldFilename").val();var newFileName=$("#newFilename").val();editorbridge.renameFile({oldFilename:oldFileName,newFilename:newFileName},function(renamed){if(renamed.success){eventManager.fire("renameFile",oldFileName,newFileName);setOperationOutput('<i class="icon-ok"></i> File successfully renamed.')}else{setOperationOutput('<i class="icon-remove"></i> '+renamed.message)}$(".modal").modal("hide")})}function handleResponse(response){response=JSON.parse(response);if(response.success){location.reload()}else{setOperationOutput('<i class="icon-remove"></i> '+response.error);$(".modal").modal("hide")}}function setOperationProgress(newprogress){$("#progress").show();$("#progress_val").width(newprogress+"%");$("#operation_output").hide()}function setOperationOutput(output){$("#progress").hide();$("#progress_val").width("0%");if(typeof compilerflasher.pluginHandler!="undefined"&&compilerflasher.pluginHandler.plugin_searched&&!compilerflasher.pluginHandler.plugin_found&&!output.match(/To program your Arduino from your browser, install the codebender|You need to update the codebender|Firefox support is discontinued./g)){output+=compilerflasher.pluginHandler.browserSpecificPluginInstall(" To program your Arduino from your browser, install the codebender")}var $operationOutput=$("#operation_output");$operationOutput.show().html(output);if(output.length>0){$operationOutput.removeClass("new-message").width();$operationOutput.addClass("new-message")}}function clearOperationOutput(){setOperationOutput("")}function showNotification(title,message,type){var hide=type!="error";new PNotify({styling:"bootstrap2",title:title,text:message,type:type,hide:hide,mouse_reset:false})}function save(){if(window.saveOrRenameOperation){return}window.saveOrRenameOperation=true;var $editorHeadingProjectname=$("#editor_heading_project_name");$editorHeadingProjectname.editable("disable");editor.aceEditor.focus();var $save=$("#save");$save.attr("disabled","disabled");$save.find("i").removeClass("icon-save").addClass("icon-spinner icon-spin");editorbridge.save(JSON.stringify(fileManager.getFiles()),function(saved){if(saved.success){eventManager.fire("saveSketch");showNotification("Saved successfully","","success")}else{showNotification("Save Failed",saved.message,"error")}$save.removeAttr("disabled");$save.find("i").removeClass("icon-spinner icon-spin").addClass("icon-save");$editorHeadingProjectname.editable("enable");window.saveOrRenameOperation=false})}function hex_success(obj){setOperationOutput("Verification successful!");showSketchSize(obj.size);$("#getHexFormInput").val(JSON.stringify({hex:obj.output}));$("#getHexForm").submit()}function before_flash(){fileManager.clearAnnotations();fileManager.removeAllMarkers();close_compiler();$("#compile_output").html("");setOperationProgress(50);hideSketchSize()}function mid_flash(size){setOperationProgress(90);showSketchSize(size)}function flash_onSuccess(){setOperationProgress(100);setOperationProgress(0);setOperationOutput("Upload successful!");editor.aceEditor.focus()}function before_verification(){fileManager.clearAnnotations();fileManager.removeAllMarkers();close_compiler();$("#compile_output").html("");setOperationProgress(90);hideSketchSize()}function flash_onFail(message,progress){setOperationProgress(0);var operationOutputMessage="Upload failed! ";if(progress==-55&&window.BrowserDetect.OS=="Linux"&&(compilerflasher.selectedBoard.name=="Adafruit FLORA"||compilerflasher.selectedBoard.name=="LightUp")){message=message.replace(/^(.+<a href='.+\/).+(' target='_blank'>.+)/,"$1"+"449114-adafruit-flora-and-lightup-in-ubuntu-linux"+"$2")}setOperationOutput(operationOutputMessage+message);editor.aceEditor.focus()}function verification_onSuccess(size){setOperationProgress(100);setOperationProgress(0);setOperationOutput("Verification successful!");showSketchSize(size);editor.aceEditor.focus()}function verification_onFail(message){setOperationProgress(0);setOperationOutput("Verification failed!");fileManager.clearAnnotations();var filesRegExp=/(In file included from\s)?\(sketch file\)\s(.+:\d+:\d*:*)(.+\S*)*/g;var fileMatches=message.match(filesRegExp);if(fileMatches!==null){var fileMatchesToAnchorHistory={};fileMatches.forEach(function(element){var tokens=element.split(filesRegExp);if(tokens.length>=5){var addAnnotation=true;if(tokens[1]=="In file included from "){addAnnotation=false}var tokenToAnchor=tokens[2];var errorHTML=tokens[3];var tokenToAnchorEscaped=tokenToAnchor.replace(/[\-\[\]\/\{}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var tokenToAnchorRegExp=new RegExp(tokenToAnchorEscaped,"g");var file=tokenToAnchor.split(":");if(file.length>=2){var filename=file[0];var row=file[1];var column=0;if(file[2]){column=file[2]}var error=tokenToAnchor;if(errorHTML){error=$($.parseHTML(errorHTML)).text().replace("error:","").trim()}if(!fileMatchesToAnchorHistory.hasOwnProperty(tokenToAnchor)){message=message.replace(tokenToAnchorRegExp,'<a href="javascript:void(0)" onclick="goToError(\''+filename+"', "+row+", "+column+');">'+tokenToAnchor+"</a>");fileMatchesToAnchorHistory[tokenToAnchor]=true}if(addAnnotation){fileManager.addAnnotation(filename,row,column,error)}}}})}$("#compile_output").html(message);open_compiler();fileManager.showAnotations(fileManager.openFname);editor.aceEditor.focus()}function goToError(file,line,column){try{var filesList=fileManager.getFiles();if(filesList.hasOwnProperty(file)){selectFile(file);editor.aceEditor.gotoLine(line,column,false);var range=new editor.lineRange(line-1,0,line,0);var marker=editor.aceEditor.getSession().addMarker(range,"compilerErrorMarker","line");setTimeout(function(){editor.aceEditor.getSession().removeMarker(marker)},2e3)}}catch(error){}}function showSketchSize(size){$("#sketch_size_number").html(size);$("#sketch_size").css({display:"inline-block"})}function hideSketchSize(){$("#sketch_size_number").html("");$("#sketch_size").hide()}function addWindowCommands(){Mousetrap.bind("mod+s",function(event){if(event.preventDefault){event.preventDefault()}if(window.inRealEditor){save()}});Mousetrap.bind("mod+shift+u",function(event){if(event.preventDefault)event.preventDefault();compilerflasher.usbflashWithProgrammer()});Mousetrap.bind("mod+r",function(event){if(event.preventDefault)event.preventDefault();compilerflasher.verify()});Mousetrap.bind("mod+u",function(event){if(event.preventDefault)event.preventDefault();compilerflasher.usbflash()});Mousetrap.bind("mod+shift+m",function(event){if(event.preventDefault){event.preventDefault()}open_serial_monitor_keybinding();compilerflasher.pluginHandler.toggle()});Mousetrap.bind("mod+alt+[",function(event){if(event.preventDefault)event.preventDefault();autoFormat()});Mousetrap.bindGlobal("mod",function(){$(window).trigger("library_search_on")},"keydown");Mousetrap.bindGlobal("mod",function(){$(window).trigger("library_search_off")},"keyup")}function autoFormat(){}function selectFile(filename){var fname=filename;if(!fileManager.isFile(fname)){fname=fileManager.inoFname}var $filesList=$("#files_list");$filesList.find("> li").removeClass("selected-file");$filesList.find('a[data-name="'+fname+'"]').parent().addClass("selected-file");if(filename!=fileManager.openFname){var user_id="";if(window.userID){user_id=window.userID}var actionId=81;var metaData={"User ID":user_id,"Sketch ID":window.projectID,"Sketch Name":fileManager.inoFname.replace(/.ino$/,""),File:filename};createLog(actionId,metaData)}eventManager.fire("selectFile",filename)}function createFile(){setOperationProgress(90);var payload={filename:$("#createfield").val()};var created=editorbridge.createFile(payload,function(created){if(created.success){eventManager.fire("addFile",payload.filename,"");setOperationOutput('<i class="icon-ok"></i> File successfully created.')}else{setOperationOutput('<i class="icon-remove"></i> '+created.message)}$(".modal").modal("hide")})}function deleteFile(filename){setOperationProgress(90);var $fileDeleteButton=$("#filedeleteButton");var $cancelFileButton=$("#cancelfiledeleteButton");$fileDeleteButton.addClass("disabled");$cancelFileButton.addClass("disabled");$fileDeleteButton.html('<i class="icon-spinner icon-spin"></i> Working...');var payload={filename:filename};editorbridge.deleteFile(payload,function(deleted){if(deleted.success){eventManager.fire("removeFile",payload.filename);setOperationOutput('<i class="icon-ok"></i> File successfully deleted.')}else{setOperationOutput('<i class="icon-remove"></i> '+deleted.message)}$(".modal").modal("hide");$fileDeleteButton.removeClass("disabled");$cancelFileButton.removeClass("disabled");$fileDeleteButton.html('<i class="icon-trash icon-white"></i> Delete File!')})}function deleteFileModal(filename){$("#filedeleteButton").attr("href",'javascript:deleteFile("'+noQuote(filename)+'")');$("#filedeleteModal").modal("show")}function showHotkeysModal(){if(typeof window.Browsers!=="undefined"&&typeof window.Browsers.os!=="undefined"){var $macHotKeys=$("#macHotkeys");var $windowsHotKeys=$("#windowsHotkeys");if(window.Browsers.os.name=="OS X"){$macHotKeys.show();$windowsHotKeys.hide()}else{$macHotKeys.hide();$windowsHotKeys.show()}}$("#hotkeysModal").modal("show")}function changePrivacy(from){var iconClass;var $editorHeadingPrivacyIcon=$("#editor_heading_privacy_icon");var $infoModalProgressMessage=$("#info_modal_progress_message");if(from=="modal"){$("#info_modal_progress").show();$infoModalProgressMessage.html('<i class="icon-spinner icon-spin"></i> Working...')}else if(from=="editor"){iconClass=$editorHeadingPrivacyIcon.find("i").attr("class");$editorHeadingPrivacyIcon.tooltip("hide").find("i").removeClass().addClass("icon-spinner icon-spin")}$.post(window.codebender.editor.changePrivacy,{data:null},function(data){try{var res=data;if(typeof data==="string"){res=JSON.parse(data)}var message="";var icon;var $privacyChangeLink=$("#privacy_change_link");var $privacyStatus=$("#privacy_status");var $embedInfo=$("#embed_info");if(res.success){if(window.isPublic){window.isPublic=false;icon="<i class='icon-lock'></i>";iconClass="icon-lock";$privacyChangeLink.html("change to public");$privacyStatus.html(icon+" Private Project");$embedInfo.hide();$editorHeadingPrivacyIcon.attr("data-original-title","This project is Private. Double click to make it Public.").find("i").removeClass().addClass("icon-lock")}else{window.isPublic=true;icon='<i class="cb-icon-globe-inv"></i>';iconClass="cb-icon-globe-inv";$privacyChangeLink.html("change to private");$privacyStatus.html(icon+" Public Project");$embedInfo.show();$editorHeadingPrivacyIcon.attr("data-original-title","This project is Public. Double click to make it Private.").find("i").removeClass().addClass("cb-icon-globe-inv")}message='<i class="icon-ok"></i> Project privacy settings successfully changed!'}else{message='<i class="icon-remove"></i> '+res.error}if(from=="modal"){$infoModalProgressMessage.html(message)}else if(from=="editor"){$editorHeadingPrivacyIcon.removeClass("inprogress").find("i").removeClass().addClass(iconClass);setOperationOutput(message)}}catch(error){setOperationOutput('<i class="icon-remove"></i> Unexpected error occurred. Try again later.');if(window.isPublic){iconClass="cb-icon-globe-inv"}else{iconClass="icon-lock"}$editorHeadingPrivacyIcon.removeClass("inprogress").find("i").removeClass().addClass(iconClass)}})}function refreshFileList(filelist){var $filesList=$("#files_list");$filesList.html("");var files=Object.keys(filelist);files.sort();var fname,liTag;for(var i=0;i<files.length;i++){fname=files[i];liTag=$('<li class="file-container"></li>');liTag.append('<i class="collaboration-sync icon-spinner icon-spin"></i>');liTag.append('<a class="filelist" href="javascript:void(0)" onclick="selectFile(\''+noQuote(fname)+'\');" data-name="'+fname+'"><span class="filename-container">'+fname+"</span></a>");if(isInoFile(fname)){liTag.addClass("inofile");$filesList.prepend(liTag)}else{liTag.append('<a class="delete-file-button" href="javascript:void(0)" title="Delete File" onclick="deleteFileModal(\''+noQuote(fname)+'\')"> <i class="icon-remove"></i></a>');liTag.append('<a class="rename-file-button" href="javascript:void(0)" title="Rename File" onclick="renameFilenameModal(\''+noQuote(fname)+'\')"><i class="icon-pencil"></i> </a>');$filesList.append(liTag)}}}